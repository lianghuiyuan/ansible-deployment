# -----------------------------
# PostgreSQL configuration file
# -----------------------------

#------------------------------------------------------------------------------#
# CONNECTION SETTINGS
#------------------------------------------------------------------------------#

# 设置 PostgreSQL 监听的地址，可以是多个地址，用逗号分隔，或设置为 '*' 来监听所有网络接口
# listen_addresses = 'localhost'  # 只监听本地 (localhost)
listen_addresses = '0.0.0.0'  # 启用所有网络接口

# 最大允许的客户端连接数
max_connections = 100

# 设置服务器的默认端口
port = 5432

#------------------------------------------------------------------------------#
# RESOURCE LIMITS
#------------------------------------------------------------------------------#

# 每个会话的最大内存缓冲区大小（MB）
shared_buffers = 128MB

# 设置用于查询缓存的工作内存大小（MB）
work_mem = 4MB

# 设置维护操作的内存大小，主要用于索引创建（MB）
maintenance_work_mem = 64MB

# 每个数据库允许的最大并发事务数
max_prepared_transactions = 150

#------------------------------------------------------------------------------#
# WRITE AHEAD LOG (WAL) SETTINGS
#------------------------------------------------------------------------------#

# WAL 文件存放的路径
wal_level = replica

# WAL 日志文件的大小（MB）
wal_buffers = 16MB

# WAL 日志保存的时长（单位：秒）
checkpoint_timeout = 5min

#------------------------------------------------------------------------------#
# LOGGING SETTINGS
#------------------------------------------------------------------------------#

# 启用/禁用日志记录
logging_collector = on

# 日志文件的目录
log_directory = 'pg_log'

# 日志文件的名称模式
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'

# 是否记录所有 SQL 语句
log_statement = 'none'

# 是否记录慢查询日志
log_min_duration_statement = 1000  # 单位：ms (1秒)

#------------------------------------------------------------------------------#
# CLIENT CONNECTION DEFAULTS
#------------------------------------------------------------------------------#

# 默认客户端编码
client_encoding = utf8

#------------------------------------------------------------------------------#
# AUTOVACUUM SETTINGS
#------------------------------------------------------------------------------#

# 启用自动清理
autovacuum = on

# 自动清理运行的最小时间间隔
autovacuum_naptime = 60

# 自动清理触发的阈值
autovacuum_vacuum_threshold = 50

#------------------------------------------------------------------------------#
# STATISTICS SETTINGS
#------------------------------------------------------------------------------#

# 启用统计功能，用于查询优化
track_counts = on
